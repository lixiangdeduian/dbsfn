# 系统测试指南

本文档提供了详细的测试步骤，帮助验证系统功能是否正常运行。

## 🧪 测试前准备

### 1. 确认数据库已初始化
```bash
# 连接到 MySQL
mysql -u root -p

# 在 MySQL 中执行
USE hospital_test;
SHOW TABLES;

# 应该能看到所有表，包括：
# - patient
# - staff
# - department
# - doctor_schedule
# - registration
# - encounter
# - invoice
# - payment
# 等等

# 检查是否有示例数据
SELECT COUNT(*) FROM department;
SELECT COUNT(*) FROM staff;
SELECT COUNT(*) FROM patient;

# 退出
EXIT;
```

### 2. 配置后端环境变量

确保 `backend/.env` 文件存在并配置正确：
```ini
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的MySQL密码
DB_NAME=hospital_test
```

### 3. 安装依赖

**后端:**
```bash
cd backend
python -m venv venv
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

pip install -r requirements.txt
```

**前端:**
```bash
cd frontend
npm install
```

## 🚀 启动测试

### 步骤 1: 测试后端健康检查

1. 启动后端：
```bash
cd backend
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

python app.py
```

2. 应该看到类似输出：
```
 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server.
 * Running on http://0.0.0.0:5000
```

3. 在浏览器中访问：http://localhost:5000/api/health

应该看到类似 JSON 响应：
```json
{
  "status": "healthy",
  "database": "connected",
  "timestamp": "2025-12-27T08:00:00.000000"
}
```

✅ 如果看到这个响应，说明后端和数据库连接正常！

### 步骤 2: 测试前端启动

1. 保持后端运行，打开新的终端/命令提示符
2. 启动前端：
```bash
cd frontend
npm run dev
```

3. 应该看到类似输出：
```
  VITE v5.0.8  ready in 500 ms

  ➜  Local:   http://localhost:3000/
  ➜  Network: use --host to expose
  ➜  press h to show help
```

4. 在浏览器中访问：http://localhost:3000

应该看到系统登录页面或主界面。

✅ 如果看到界面，说明前端启动成功！

## 📋 功能测试清单

### 1. 仪表盘测试 ✅

**测试步骤:**
1. 打开浏览器访问：http://localhost:3000
2. 点击侧边栏 "仪表盘"
3. 检查是否显示统计卡片（今日就诊人次、今日挂号数、今日收入等）

**预期结果:**
- 显示4个统计卡片
- 数据正常加载（即使是0也应该显示）
- 没有错误提示

### 2. 患者管理测试 ✅

#### 2.1 查看患者列表
**测试步骤:**
1. 点击侧边栏 "患者管理"
2. 查看患者列表

**预期结果:**
- 显示患者列表表格
- 有搜索框和"新建患者"按钮
- 表格有分页功能

#### 2.2 创建患者
**测试步骤:**
1. 点击 "新建患者" 按钮
2. 填写表单：
   - 姓名：张三
   - 性别：男
   - 出生日期：1990-01-01
   - 身份证号：110101199001011234
   - 联系电话：13800138000
   - 血型：A型
3. 点击 "提交"

**预期结果:**
- 显示 "创建成功" 提示
- 自动跳转到患者列表
- 列表中显示新创建的患者

#### 2.3 编辑患者
**测试步骤:**
1. 在患者列表中点击某个患者的 "编辑" 按钮
2. 修改联系电话
3. 点击 "提交"

**预期结果:**
- 显示 "更新成功" 提示
- 返回列表，数据已更新

#### 2.4 搜索患者
**测试步骤:**
1. 在搜索框输入患者姓名或电话
2. 点击 "搜索"

**预期结果:**
- 显示匹配的患者记录

### 3. 科室管理测试 ✅

**测试步骤:**
1. 点击侧边栏 "科室管理"
2. 点击 "新建科室" 按钮
3. 填写表单：
   - 科室编码：001
   - 科室名称：内科
4. 点击 "确定"

**预期结果:**
- 显示 "创建成功" 提示
- 科室列表中显示新创建的科室

### 4. 员工管理测试 ✅

**测试步骤:**
1. 点击侧边栏 "员工管理"
2. 点击 "新建员工" 按钮
3. 填写表单：
   - 姓名：李医生
   - 性别：男
   - 职称：主治医师
   - 联系电话：13900139000
   - 所属科室：选择刚创建的科室
4. 点击 "提交"

**预期结果:**
- 显示 "创建成功" 提示
- 员工列表中显示新创建的员工

### 5. 排班管理测试 ✅

**测试步骤:**
1. 点击侧边栏 "排班管理"
2. 点击 "新建排班" 按钮
3. 填写表单：
   - 医生：选择刚创建的医生
   - 科室：选择对应科室
   - 排班日期：选择明天的日期
   - 开始时间：08:00:00
   - 结束时间：12:00:00
   - 号源数量：10
   - 挂号费：10
4. 点击 "提交"

**预期结果:**
- 显示 "创建成功" 提示
- 排班列表中显示新创建的排班

### 6. 预约挂号测试 ✅

**测试步骤:**
1. 点击侧边栏 "挂号管理"
2. 点击 "预约挂号" 按钮
3. 填写表单：
   - 患者：选择刚创建的患者
   - 就诊日期：选择有排班的日期
   - 科室：选择对应科室
   - 在排班表中点击 "选择"
   - 主诉：头痛
4. 点击 "提交预约"

**预期结果:**
- 显示 "预约成功" 提示
- 挂号列表中显示新创建的挂号记录
- 状态为 "已确认"

### 7. 到院登记测试 ✅

**测试步骤:**
1. 点击侧边栏 "就诊管理"
2. 点击 "到院登记" 按钮
3. 填写表单：
   - 患者：选择刚创建的患者
   - 科室：选择对应科室
   - 医生：选择对应医生
4. 点击 "提交登记"

**预期结果:**
- 显示 "登记成功" 提示
- 就诊列表中显示新创建的就诊记录
- 状态为 "进行中"

### 8. 开账单测试 ✅

**测试步骤:**
1. 点击侧边栏 "收费管理"
2. 点击 "开账单" 按钮
3. 填写表单：
   - 患者：选择刚创建的患者
   - 总金额：100
4. 点击 "开具账单"

**预期结果:**
- 显示 "开票成功" 提示
- 发票列表中显示新创建的发票
- 状态为 "未结清"

### 9. 收款测试 ✅

**测试步骤:**
1. 在发票列表中找到刚创建的发票
2. 点击 "收款" 按钮
3. 填写表单：
   - 支付方式：现金
   - 支付金额：100
4. 点击 "确认收款"

**预期结果:**
- 显示 "收款成功" 提示
- 返回发票列表
- 发票状态变为 "已付清"

### 10. 统计报表测试 ✅

**测试步骤:**
1. 点击侧边栏 "统计报表"
2. 选择日期范围
3. 点击 "查询"

**预期结果:**
- 显示三个统计表格：
  - 科室收入统计
  - 医生工作量统计
  - 每日收入统计
- 数据正常显示

## 🔍 API 测试（可选）

使用 Postman 或 curl 测试 API：

### 测试健康检查
```bash
curl http://localhost:5000/api/health
```

### 测试获取患者列表
```bash
curl http://localhost:5000/api/patients/
```

### 测试创建患者
```bash
curl -X POST http://localhost:5000/api/patients/ \
  -H "Content-Type: application/json" \
  -d '{
    "patient_name": "测试患者",
    "gender": "M",
    "phone": "13800138000"
  }'
```

### 测试获取科室列表
```bash
curl http://localhost:5000/api/departments/
```

### 测试仪表盘统计
```bash
curl http://localhost:5000/api/statistics/dashboard
```

## ✅ 测试完成清单

完成以下所有测试项后，系统功能验证完成：

- [ ] 后端健康检查通过
- [ ] 前端成功启动并显示界面
- [ ] 仪表盘数据正常显示
- [ ] 患者管理功能正常（增删改查）
- [ ] 科室管理功能正常
- [ ] 员工管理功能正常
- [ ] 排班管理功能正常
- [ ] 预约挂号功能正常
- [ ] 到院登记功能正常
- [ ] 开账单功能正常
- [ ] 收款功能正常
- [ ] 统计报表功能正常

## 🐛 常见问题排查

### 后端无法启动

1. 检查 Python 版本：`python --version`
2. 检查虚拟环境是否激活
3. 检查依赖是否安装：`pip list`
4. 查看错误日志

### 前端无法启动

1. 检查 Node.js 版本：`node --version`
2. 检查依赖是否安装：`npm list`
3. 删除 `node_modules` 重新安装
4. 查看错误日志

### 数据库连接失败

1. 检查 MySQL 服务是否运行
2. 检查 `.env` 配置是否正确
3. 检查数据库是否已创建
4. 检查用户权限

### API 请求失败

1. 检查后端是否运行
2. 打开浏览器开发者工具查看 Network 标签
3. 检查 CORS 配置
4. 检查 API 路径是否正确

## 📊 性能测试（可选）

### 并发测试
使用 Apache Bench 进行简单的并发测试：

```bash
# 安装 Apache Bench (Windows需要单独下载)
# macOS/Linux
sudo apt install apache2-utils  # Ubuntu/Debian
brew install ab  # macOS

# 测试健康检查接口（100个请求，10个并发）
ab -n 100 -c 10 http://localhost:5000/api/health

# 测试患者列表接口
ab -n 100 -c 10 http://localhost:5000/api/patients/
```

### 负载测试
对于更专业的负载测试，可以使用：
- JMeter
- Locust
- k6

## 📝 测试报告模板

测试完成后，可以使用以下模板记录测试结果：

```
测试日期：2025-12-27
测试人员：[你的名字]
系统版本：1.0.0

测试环境：
- 操作系统：Windows 11 / macOS / Ubuntu
- Python 版本：3.10
- Node.js 版本：18.x
- MySQL 版本：8.0

测试结果：
✅ 所有功能测试通过
✅ API 测试通过
✅ 前后端集成正常

发现的问题：
1. [无] 或 [列出发现的问题]

建议：
1. [列出改进建议]

总结：
系统功能完整，运行稳定，可以正常使用。
```

---

**祝测试顺利！** 🎉

